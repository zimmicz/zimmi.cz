<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
        <title>Michal Zimmermann | Pieces of knowledge from the world of GIS.</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
        <link href="https://www.zimmi.cz/posts/atom.xml" type="application/atom+xml" rel="alternate" title="Michal Zimmermann Full Atom Feed" />
        <link href="https://www.zimmi.cz/posts/feed.xml" type="application/rss+xml" rel="alternate" title="Michal Zimmermann Full RSS Feed" />
        <link rel="stylesheet" href="https://www.zimmi.cz/posts/theme/css/style.min.css?9908e745">
</head>
<body>
    <nav role="navigation">
        <ul>
            <li><a href="https://www.zimmi.cz/posts/categories">Categories</a></li>
            <li><a href="https://www.zimmi.cz/posts/tags">Tags</a></li>
            <li><a href="https://www.zimmi.cz/posts/feed.xml">Subscribe to RSS feed</a></li>
            <li>
                <form class="search" name="x" action="//duckduckgo.com/" target="_blank">
                    <input type="hidden" value="zimmi.cz/posts" name="sites" />
                    <input class="search-input" type="search" placeholder="Search" name="q" />
                    <input class="button" type="submit" value="Go" />
                </form>
            </li>
        </ul>
    </nav>
    <header>
        <h1><a href="/posts">Michal Zimmermann<small>Pieces of knowledge from the world of GIS.</small></a></h1>
    </header>
    <main>

<article>
    <h1><a href="https://www.zimmi.cz/posts/2020/postgis-data-anonymization/" rel="bookmark" title="Permalink to PostGIS Data Anonymization">PostGIS Data&nbsp;Anonymization</a></h1>
    <aside><span>May 5, 2020</span>
    <span>    <a class="tag-url" href="https://www.zimmi.cz/posts/tag/postgresql.html">postgresql</a>     <a class="tag-url" href="https://www.zimmi.cz/posts/tag/postgis.html">postgis</a>    </span>
    <span><a class="category-url" href="https://www.zimmi.cz/posts/category/sql.html">SQL</a></span>
    </aside>
    <p>Among all the sensitive spatial data being collected through cellphones and credit cards, our address of residency is probably the most delicate one. Can it be anonymized/pseudonymized/obscured before you share it with your business&nbsp;partners?</p>
<p>Imagine given a set of address points for each of your clients and the set of all address points in the country, you should adjust it in the following&nbsp;way:</p>
<ul>
<li>find the two nearest address points for each address point of your&nbsp;client</li>
<li>find the center of these two and the client address&nbsp;point</li>
<li>measure the distance of the computed center to each of three points and keep the maximum&nbsp;value</li>
<li>make the biggest distance even bigger by adding 10 % of its&nbsp;value</li>
<li>ceil the&nbsp;value</li>
<li>output the new position and the ceiled&nbsp;distance</li>
</ul>
<div class="text-center"><img src="https://www.zimmi.cz/posts/assets/postgis-data-anonymization/qgis.gif"/></div>

<p>This shifts each address point by a dynamic distance, giving us at least three points within the given distance (one of them being the original address&nbsp;point).</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span>
    <span class="n">tmp</span><span class="p">.</span><span class="n">code</span><span class="p">,</span>
    <span class="n">ST_X</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">new_position</span><span class="p">)</span> <span class="n">x</span><span class="p">,</span>
    <span class="n">ST_Y</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">new_position</span><span class="p">)</span> <span class="n">y</span><span class="p">,</span>
    <span class="n">ceil</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">biggest_distance</span><span class="p">)</span> <span class="o">+</span> <span class="k">MAX</span><span class="p">(</span><span class="n">biggest_distance</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="n">round_distance</span>
<span class="k">FROM</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="n">tmp</span><span class="p">.</span><span class="n">code</span><span class="p">,</span>
        <span class="n">tmp</span><span class="p">.</span><span class="n">geom</span><span class="p">,</span>
        <span class="n">ST_Centroid</span><span class="p">((</span><span class="n">ST_Union</span><span class="p">(</span><span class="n">two_closest_points</span><span class="p">,</span> <span class="n">tmp</span><span class="p">.</span><span class="n">geom</span><span class="p">)))</span> <span class="n">new_position</span><span class="p">,</span>
        <span class="c1">-- get distance to two closest points and the client address point</span>
        <span class="n">ST_Centroid</span><span class="p">((</span><span class="n">ST_Union</span><span class="p">(</span><span class="n">two_closest_points</span><span class="p">,</span> <span class="n">tmp</span><span class="p">.</span><span class="n">geom</span><span class="p">)))</span> <span class="o">&lt;-&gt;</span> <span class="p">(</span><span class="n">ST_DumpPoints</span><span class="p">(</span><span class="n">ST_Union</span><span class="p">(</span><span class="n">two_closest_points</span><span class="p">,</span> <span class="n">tmp</span><span class="p">.</span><span class="n">geom</span><span class="p">))).</span><span class="n">geom</span> <span class="n">biggest_distance</span>
    <span class="k">FROM</span> <span class="p">(</span>
        <span class="k">SELECT</span>
            <span class="n">r1</span><span class="p">.</span><span class="n">code</span><span class="p">,</span>
            <span class="n">r1</span><span class="p">.</span><span class="n">geom</span><span class="p">,</span>
            <span class="n">ST_Union</span><span class="p">(</span><span class="n">neighbours</span><span class="p">.</span><span class="n">geom</span><span class="p">)</span> <span class="n">two_closest_points</span>
        <span class="k">FROM</span> <span class="n">address_points</span> <span class="n">r1</span><span class="p">,</span>
        <span class="k">LATERAL</span> <span class="p">(</span>
            <span class="c1">-- keep two closest points to each client address point</span>
            <span class="k">SELECT</span>
                <span class="n">r2</span><span class="p">.</span><span class="n">code</span><span class="p">,</span>
                <span class="n">r2</span><span class="p">.</span><span class="n">geom</span><span class="p">,</span>
                <span class="n">r1</span><span class="p">.</span><span class="n">geom</span> <span class="o">&lt;-&gt;</span> <span class="n">r2</span><span class="p">.</span><span class="n">geom</span> <span class="n">distance</span>
            <span class="k">FROM</span> <span class="n">address_points</span> <span class="n">r2</span>
            <span class="k">WHERE</span> <span class="n">r1</span><span class="p">.</span><span class="n">code</span> <span class="o">&lt;&gt;</span> <span class="n">r2</span><span class="p">.</span><span class="n">code</span>
            <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">r1</span><span class="p">.</span><span class="n">geom</span> <span class="o">&lt;-&gt;</span> <span class="n">r2</span><span class="p">.</span><span class="n">geom</span> <span class="k">ASC</span>
            <span class="k">LIMIT</span> <span class="mi">2</span>
        <span class="p">)</span> <span class="n">neighbours</span>
        <span class="k">GROUP</span> <span class="k">BY</span>
            <span class="n">r1</span><span class="p">.</span><span class="n">code</span><span class="p">,</span>
            <span class="n">r1</span><span class="p">.</span><span class="n">geom</span>
    <span class="p">)</span> <span class="n">tmp</span>
<span class="p">)</span> <span class="n">tmp</span>
<span class="k">GROUP</span> <span class="k">BY</span>
    <span class="n">tmp</span><span class="p">.</span><span class="n">code</span><span class="p">,</span>
    <span class="n">tmp</span><span class="p">.</span><span class="n">geom</span><span class="p">,</span>
    <span class="n">tmp</span><span class="p">.</span><span class="n">new_position</span><span class="p">;</span>
</pre></div>


<p>You might want to use <code>LATERAL</code> for tasks like&nbsp;this.</p>
</article>
<article>
    <h1><a href="https://www.zimmi.cz/posts/2018/centos-postgis-upgrade-hell-yet-again" rel="bookmark" title="Permalink to CentOS PostGIS Upgrade Hell… Yet Again">CentOS PostGIS Upgrade Hell&#8230; Yet&nbsp;Again</a></h1>
    <aside><span>Dec 19, 2018</span>
    <span>    <a class="tag-url" href="https://www.zimmi.cz/posts/tag/postgresql.html">postgresql</a>     <a class="tag-url" href="https://www.zimmi.cz/posts/tag/postgis.html">postgis</a>    </span>
    <span><a class="category-url" href="https://www.zimmi.cz/posts/category/sql.html">SQL</a></span>
    </aside>
    <p><a href="https://www.zimmi.cz/posts/2017/upgrading-postgresql-95-to-postgresql-96-with-postgis/">PostGIS upgrades used to be a nightmare</a>. Broken dependencies, version mismatches, you name it. Upgrading PostgreSQL 10 with PostGIS 2.4 to PostgreSQL 11 on CentOS has been my mission impossible for two days. And it doesn&#8217;t seem to come to an&nbsp;end.</p>
<h2>What?&nbsp;Why?</h2>
<p>We&#8217;re running fairly large spatially enabled PostgreSQL 10 database cluster. To keep up with pretty fast development, I was hoping to <code>pg_upgrade</code> it to PostgreSQL&nbsp;11.</p>
<h2>Tried and&nbsp;failed</h2>
<p>I&#8217;ve been trying different upgrade strategies with PostgreSQL 11 already running to no avail. Here comes the&nbsp;list.</p>
<h3>Install PostGIS 2.4 to PostgreSQL 11 and&nbsp;pg_upgrade</h3>
<div class="highlight"><pre><span></span>yum install postgis24_11
systemctl stop postgresql-11

su postgres
/usr/pgsql-11/bin/pg_upgrade <span class="se">\</span>
  --check <span class="se">\</span>
  -b /usr/pgsql-10/bin/ -B /usr/pgsql-11/bin/ <span class="se">\</span>
  -d /var/lib/pgsql/10/data -D /var/lib/pgsql/11/data <span class="se">\</span>
  --link <span class="se">\</span>
  -U root <span class="se">\</span>
  -o <span class="s1">&#39; -c config_file=/var/lib/pgsql/10/data/postgresql.conf&#39;</span> -O <span class="s1">&#39; -c config_file=/var/lib/pgsql/11/data/postgresql.conf&#39;</span>
</pre></div>


<p>This results&nbsp;in:</p>
<blockquote>
<p>Your installation references loadable libraries that are missing from the
new installation.  You can add these libraries to the new installation,
or remove the functions using them from the old installation.  A list of
problem libraries is in the file:&nbsp;loadable_libraries.txt</p>
</blockquote>
<p><code>loadable_libraries.txt</code> says the&nbsp;following:</p>
<div class="highlight"><pre><span></span>could not load library <span class="s2">&quot;</span><span class="nv">$libdir</span><span class="s2">/postgis-2.4&quot;</span>: ERROR:  could not load library <span class="s2">&quot;/usr/pgsql-11/lib/postgis-2.4.so&quot;</span>: /usr/pgsql-11/lib/postgis-2.4.so: undefined symbol: geod_polygon_init
</pre></div>


<p>Duckduckgoing I found the related <a href="https://www.postgresql.org/message-id/15450-a3638dc978caa94d@postgresql.org">PostgreSQL mailing list thread</a>.</p>
<h3>Build and install PostGIS 2.4 from source to PostgreSQL 11 and&nbsp;pg_upgrade</h3>
<p>The bug report says there&#8217;s something wrong with <code>proj4</code> version, so I chose <code>proj49</code> and <code>geos37</code>.</p>
<div class="highlight"><pre><span></span>yum install proj49 proj49-devel
wget https://download.osgeo.org/postgis/source/postgis-2.4.6.tar.gz
tar -xzvf postgis-2.4.6.tar.gz
<span class="nb">cd</span> postgis-2.4.6

./configure <span class="se">\</span>
  --with-pgconfig<span class="o">=</span>/usr/pgsql-11/bin/pg_config <span class="se">\</span>
  --with-geosconfig<span class="o">=</span>/usr/geos37/bin/geos-config <span class="se">\</span>
  --with-projdir<span class="o">=</span>/usr/proj49/

make <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> make install
</pre></div>


<p><code>CREATE EXTENSION postgis</code> fails with <code>could not load library "/usr/pgsql-11/lib/postgis-2.4.so": /usr/pgsql-11/lib/postgis-2.4.so: undefined symbol: geod_polygon_init</code>. Oh&nbsp;my.</p>
<h3>Install PostGIS 2.5 to PostgreSQL 10 and&nbsp;pg_upgrade</h3>
<p>Running out of ideas, I tried to install PostGIS 2.5 to our PostgreSQL 10 cluster and&nbsp;pg_upgrade.</p>
<div class="highlight"><pre><span></span>yum install postgis25_10
</pre></div>


<p>The resulting error appeared almost&nbsp;instantly:</p>
<div class="highlight"><pre><span></span>Transaction check error:
file /usr/pgsql-10/bin/shp2pgsql-gui from install of postgis25_10-2.5.1-1.rhel7.x86_64 conflicts with file from package postgis24_10-2.4.5-1.rhel7.x86_64
file /usr/pgsql-10/lib/liblwgeom.so from install of postgis25_10-2.5.1-1.rhel7.x86_64 conflicts with file from package postgis24_10-2.4.5-1.rhel7.x86_64
file /usr/pgsql-10/lib/postgis-2.4.so from install of postgis25_10-2.5.1-1.rhel7.x86_64 conflicts with file from package postgis24_10-2.4.5-1.rhel7.x86_64
file /usr/pgsql-10/share/extension/address_standardizer.control from install of postgis25_10-2.5.1-1.rhel7.x86_64 conflicts with file from package postgis24_10-2.4.5-1.rhel7.x86_64
file /usr/pgsql-10/share/extension/address_standardizer.sql from install of postgis25_10-2.5.1-1.rhel7.x86_64 conflicts with file from package postgis24_10-2.4.5-1.rhel7.x86_64
file /usr/pgsql-10/share/extension/address_standardizer_data_us.control from install of postgis25_10-2.5.1-1.rhel7.x86_64 conflicts with file from package postgis24_10-2.4.5-1.rhel7.x86_64
file /usr/pgsql-10/share/extension/address_standardizer_data_us.sql from install of postgis25_10-2.5.1-1.rhel7.x86_64 conflicts with file from package postgis24_10-2.4.5-1.rhel7.x86_64
file /usr/pgsql-10/share/extension/postgis.control from install of postgis25_10-2.5.1-1.rhel7.x86_64 conflicts with file from package postgis24_10-2.4.5-1.rhel7.x86_64
file /usr/pgsql-10/share/extension/postgis_sfcgal.control from install of postgis25_10-2.5.1-1.rhel7.x86_64 conflicts with file from package postgis24_10-2.4.5-1.rhel7.x86_64
file /usr/pgsql-10/share/extension/postgis_tiger_geocoder.control from install of postgis25_10-2.5.1-1.rhel7.x86_64 conflicts with file from package postgis24_10-2.4.5-1.rhel7.x86_64
file /usr/pgsql-10/share/extension/postgis_topology.control from install of postgis25_10-2.5.1-1.rhel7.x86_64 conflicts with file from package postgis24_10-2.4.5-1.rhel7.x86_64
</pre></div>


<p>What&nbsp;the&hellip;</p>
<h3>Build and install PostGIS 2.5 from source to PostgreSQL 10 and&nbsp;pg_upgrade</h3>
<div class="highlight"><pre><span></span>wget https://download.osgeo.org/postgis/source/postgis-2.5.1.tar.gz
tar -xzvf postgis-2.5.1.tar.gz
<span class="nb">cd</span> postgis-2.5.1

./configure <span class="se">\</span>
  --with-pgconfig<span class="o">=</span>/usr/pgsql-10/bin/pg_config <span class="se">\</span>
  --with-geosconfig<span class="o">=</span>/usr/geos37/bin/geos-config

make <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> make install
</pre></div>


<p><code>CREATE EXTENSION postgis</code> fails with <code>ERROR:  could not load library "/usr/pgsql-10/lib/postgis-2.5.so": /usr/pgsql-10/lib/postgis-2.5.so: undefined symbol: GEOSFrechetDistanceDensify</code>. Again?&nbsp;Really?</p>
<p><code>GEOSFrechetDistanceDensify</code> was added in <span class="caps">GEOS</span> 3.7 (linked in <code>./configure</code>), yet <code>ldd /usr/pgsql-10/lib/postgis-2.5.so</code> says:</p>
<div class="highlight"><pre><span></span>linux-vdso.so.1 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span>  <span class="o">(</span>0x00007ffd4c5fa000<span class="o">)</span>
libgeos_c.so.1 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /usr/geos36/lib64/libgeos_c.so.1 <span class="o">(</span>0x00007f68ddf5a000<span class="o">)</span>
libproj.so.0 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /lib64/libproj.so.0 <span class="o">(</span>0x00007f68ddd07000<span class="o">)</span>
libjson-c.so.2 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /lib64/libjson-c.so.2 <span class="o">(</span>0x00007f68ddafc000<span class="o">)</span>
libxml2.so.2 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /lib64/libxml2.so.2 <span class="o">(</span>0x00007f68dd792000<span class="o">)</span>
libm.so.6 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /lib64/libm.so.6 <span class="o">(</span>0x00007f68dd48f000<span class="o">)</span>
libSFCGAL.so.1 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /lib64/libSFCGAL.so.1 <span class="o">(</span>0x00007f68dc9c0000<span class="o">)</span>
libc.so.6 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /lib64/libc.so.6 <span class="o">(</span>0x00007f68dc5f3000<span class="o">)</span>
libgeos-3.6.3.so <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /usr/geos36/lib64/libgeos-3.6.3.so <span class="o">(</span>0x00007f68dc244000<span class="o">)</span>
libstdc++.so.6 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /lib64/libstdc++.so.6 <span class="o">(</span>0x00007f68dbf3d000<span class="o">)</span>
libgcc_s.so.1 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /lib64/libgcc_s.so.1 <span class="o">(</span>0x00007f68dbd27000<span class="o">)</span>
libdl.so.2 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /lib64/libdl.so.2 <span class="o">(</span>0x00007f68dbb22000<span class="o">)</span>
libz.so.1 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /lib64/libz.so.1 <span class="o">(</span>0x00007f68db90c000<span class="o">)</span>
liblzma.so.5 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /lib64/liblzma.so.5 <span class="o">(</span>0x00007f68db6e6000<span class="o">)</span>
/lib64/ld-linux-x86-64.so.2 <span class="o">(</span>0x000055960f119000<span class="o">)</span>
libCGAL.so.11 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /usr/lib64/libCGAL.so.11 <span class="o">(</span>0x00007f68db4bd000<span class="o">)</span>
libCGAL_Core.so.11 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /usr/lib64/libCGAL_Core.so.11 <span class="o">(</span>0x00007f68db284000<span class="o">)</span>
libmpfr.so.4 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /usr/lib64/libmpfr.so.4 <span class="o">(</span>0x00007f68db029000<span class="o">)</span>
libgmp.so.10 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /usr/lib64/libgmp.so.10 <span class="o">(</span>0x00007f68dadb0000<span class="o">)</span>
libboost_date_time-mt.so.1.53.0 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /usr/lib64/libboost_date_time-mt.so.1.53.0 <span class="o">(</span>0x00007f68dab9f000<span class="o">)</span>
libboost_thread-mt.so.1.53.0 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /usr/lib64/libboost_thread-mt.so.1.53.0 <span class="o">(</span>0x00007f68da988000<span class="o">)</span>
libboost_system-mt.so.1.53.0 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /usr/lib64/libboost_system-mt.so.1.53.0 <span class="o">(</span>0x00007f68da783000<span class="o">)</span>
libboost_serialization-mt.so.1.53.0 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /usr/lib64/libboost_serialization-mt.so.1.53.0 <span class="o">(</span>0x00007f68da517000<span class="o">)</span>
libpthread.so.0 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /lib64/libpthread.so.0 <span class="o">(</span>0x00007f68da2fa000<span class="o">)</span>
librt.so.1 <span class="o">=</span><span class="p">&amp;</span>gt<span class="p">;</span> /usr/lib64/librt.so.1 <span class="o">(</span>0x00007f68da0f2000<span class="o">)</span>
</pre></div>


<p>I&#8217;m nearly desperate after spending two days trying to break through. I have ~ 300 <span class="caps">GB</span> of PostgreSQL data to migrate to the current version and there seems to be no possible way to do it in&nbsp;CentOS.</p>
<p>One more thing to note: using <code>yum install postgis25_11</code> and <code>CREATE EXTENSION postgis</code> in v11 database fails with the exact same error like the one above. I really enjoy working with PostgreSQL and PostGIS, yet there&#8217;s hardly something I fear more than trying to upgrade those two things&nbsp;together.</p>
</article>
<article>
    <h1><a href="https://www.zimmi.cz/posts/2018/implementing-linked-list-with-postgresql-recursive-cte/" rel="bookmark" title="Permalink to Implementing Linked List with PostgreSQL Recursive CTE">Implementing Linked List with PostgreSQL Recursive <span class="caps">CTE</span></a></h1>
    <aside><span>Nov 26, 2018</span>
    <span>    <a class="tag-url" href="https://www.zimmi.cz/posts/tag/postgresql.html">postgresql</a>    </span>
    <span><a class="category-url" href="https://www.zimmi.cz/posts/category/sql.html">SQL</a></span>
    </aside>
    <p>I&#8217;ve been working on a book/storytelling pet project recently. Dealing with book events and keeping them in order was a task that was to be tackled sooner or later. While both frontend and backend of the app could deal with linked and ordered data, database might be just about the best place to do&nbsp;so.</p>
<h2>What you might need a linked list&nbsp;for</h2>
<p>You have a set of chronological events. The set is not complete at the beginning and position of events might be changed (e.g. their neighbouring events might change in&nbsp;time).</p>
<h2>Implementation</h2>
<p>Linked list is a perfect structure for such a case (see <a href="https://en.wikipedia.org/wiki/Linked_list">Wikipedia</a>). You can keep your data in tact using just id and previous/next&nbsp;id.</p>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">public</span><span class="p">.</span><span class="n">events</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">integer</span> <span class="k">generated</span> <span class="n">always</span> <span class="k">as</span> <span class="k">identity</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
  <span class="n">previous_id</span> <span class="nb">integer</span>
<span class="p">);</span>

<span class="k">COPY</span> <span class="k">public</span><span class="p">.</span><span class="n">events</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">previous_id</span><span class="p">)</span> <span class="k">FROM</span> <span class="k">stdin</span><span class="p">;</span>
<span class="mi">7</span>   <span class="err">\</span><span class="n">N</span>
<span class="mi">10</span>  <span class="mi">5</span>
<span class="mi">5</span>   <span class="mi">1</span>
<span class="mi">1</span>   <span class="mi">3</span>
<span class="mi">3</span>   <span class="mi">8</span>
<span class="mi">8</span>   <span class="mi">9</span>
<span class="mi">9</span>   <span class="mi">2</span>
<span class="mi">2</span>   <span class="mi">6</span>
<span class="mi">6</span>   <span class="mi">4</span>
<span class="mi">4</span>   <span class="mi">7</span>
<span class="err">\</span><span class="p">.</span>
</pre></div>


<p>Generating the list of events in the right order is the matter of running one recursive <span class="caps">CTE</span>&nbsp;query.</p>
<div class="highlight"><pre><span></span><span class="k">WITH</span> <span class="k">RECURSIVE</span> <span class="n">evt</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="p">(</span>
<span class="k">SELECT</span>
    <span class="n">id</span><span class="p">,</span>
    <span class="n">previous_id</span>
<span class="k">FROM</span> <span class="n">events</span>
<span class="k">WHERE</span> <span class="n">previous_id</span> <span class="k">IS</span> <span class="k">NULL</span>
<span class="k">UNION</span>
<span class="k">SELECT</span>
    <span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">e</span><span class="p">.</span><span class="n">previous_id</span>
<span class="k">FROM</span> <span class="n">events</span> <span class="n">e</span>
<span class="k">JOIN</span> <span class="n">evt</span> <span class="k">ON</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">previous_id</span> <span class="o">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">evt</span><span class="p">;</span>
</pre></div>


<p>It gathers the first event (the one having the previous pointer set to <code>NULL</code>) and iteratively adds the following ones. Note that this version is actually the <em>reverse</em> implementation of the linked list, pointing to the previous instead of the next event. All it would take to change that, would be finding the event id not present in <code>previous_id</code> column as the first one instead of <code>WHERE previous_id IS NULL</code>.</p>
<p>With the data coming properly sorted to the client, all it has to do is rendering the&nbsp;list.</p>
</article>
<article>
    <h1><a href="https://www.zimmi.cz/posts/2018/postgresql-backup-and-recovery-orchestration-systemd-automation/" rel="bookmark" title="Permalink to PostgreSQL Backup and Recovery Orchestration: systemd Automation">PostgreSQL Backup and Recovery Orchestration: systemd&nbsp;Automation</a></h1>
    <aside><span>Apr 10, 2018</span>
    <span>    <a class="tag-url" href="https://www.zimmi.cz/posts/tag/postgresql.html">postgresql</a>     <a class="tag-url" href="https://www.zimmi.cz/posts/tag/linux.html">linux</a>    </span>
    <span><a class="category-url" href="https://www.zimmi.cz/posts/category/sql.html">SQL</a></span>
    </aside>
    <p>Posts in this series have described the basic automation of PostgreSQL backup/recovery strategy. The process itself consists of different periodic tasks that shouldn&#8217;t be executed manually. There are essentially two tools dedicated to periodic task running in Linux: <strong>cron</strong> and <strong>systemd</strong>.</p>
<p>Cron used to be my first choice of automation in Linux, as it&#8217;s very easy to use. On the other hand, it&#8217;s quite messy (running <code>crontab -e</code> under different users to find out which one has the job defined) and a bit difficult to test - many times I ran into a situation when underlying bash script executed just fine, while cron job kept failing for reason&nbsp;unknown.</p>
<p>My own cron experience together with a few words from a workmate brought me into the arms of systemd, which is a Linux system and service manager. It&#8217;s capable of running periodic tasks just like cron, yet making it more&nbsp;transparent.</p>
<h2>Important&nbsp;bits</h2>
<p>Understanding the whole systemd is way out of scope of a poor <span class="caps">GIS</span> guy, yet I managed to tame three important parts of the&nbsp;ecosystem:</p>
<ul>
<li>services</li>
<li>timers</li>
<li>targets</li>
</ul>
<h3>Services</h3>
<p>Service is a configuration saved inside &#8220;.service&#8221; file specifying what you want systemd to do. Following code shows how you can tell systemd to vacuum your database once in a&nbsp;while.</p>
<div class="highlight"><pre><span></span><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>CR vacuumdb
<span class="nv">OnFailure</span><span class="o">=</span>unit-status-mail@%n.service unit-status-slack@%n.service
<span class="nv">Wants</span><span class="o">=</span>cr-sunday.timer

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">User</span><span class="o">=</span>postgres
<span class="nv">Group</span><span class="o">=</span>postgres
<span class="nv">Type</span><span class="o">=</span>simple
<span class="nv">ExecStart</span><span class="o">=</span>/bin/bash /usr/local/sbin/pgsql-vacuumdb.sh --port %i

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>cr-sunday.target
</pre></div>


<p>Unit files come with several handy features. First of all, they are orchestrated with <code>systemctl</code>. Second, any service configuration file containing <code>@</code> in its filename might be symlinked/copied and run for different instances. Third, notice <code>OnFailure</code> directive in the code above. If anything goes wrong, systemd might serve as a postman delivering the bad news. I set up both e-mail and Slack notifications and they&#8217;ve been working like a charm ever&nbsp;since.</p>
<p>On top of that, I find systemd orchestration much easier to test and maintain compared to&nbsp;cron.</p>
<p>With the above code saved in <code>/lib/systemd/system/pgsql-vacuumdb@.service</code>, you can copy the file to <code>/lib/systemd/system/pgsql-vacuumdb@5432.service</code>, <code>/lib/systemd/system/pgsql-vacuumdb@5432.service</code> etc. If you look at <code>ExecStart</code> part of the service file, you&#8217;ll notice <code>%i</code> being used at the end - a <a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">placeholder</a> replaced with the string between <code>@</code> and <code>.service</code> in the&nbsp;filename.</p>
<p>This systemd service file is no more than a simple wrapper around the following bash code. We run three different database clusters on one machine and this approach makes their maintenance pretty&nbsp;comfortable.</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1"># @author: Michal Zimmermann &amp;lt;michal.zimmermann@clevermaps.cz&amp;gt;</span>
<span class="c1"># Vacuums the whole database cluster running on a given port.</span>

<span class="k">while</span> <span class="o">[[</span> <span class="nv">$#</span> <span class="p">&amp;</span>gt<span class="p">;</span> <span class="m">0</span> <span class="o">]]</span>
<span class="k">do</span>
    <span class="nv">key</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>

    <span class="k">case</span> <span class="nv">$key</span> in
        -p<span class="p">|</span>--port<span class="o">)</span>
            <span class="nv">PORT</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        *<span class="o">)</span>
            <span class="nb">echo</span> <span class="s2">&quot;Usage: `basename </span><span class="nv">$0</span><span class="s2">` --port|-p [port_number]&quot;</span>
            <span class="nb">exit</span> <span class="m">1</span>
            <span class="p">;;</span>
    <span class="k">esac</span>
    <span class="nb">shift</span>
<span class="k">done</span>

<span class="k">if</span> <span class="o">[[</span> -z <span class="s2">&quot;</span><span class="nv">$PORT</span><span class="s2">&quot;</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Port not provided!&quot;</span>
    <span class="nv">$0</span> *
    <span class="nb">exit</span> <span class="m">2</span>
<span class="k">fi</span>

/usr/bin/vacuumdb -U postgres -p <span class="nv">$PORT</span> --all --full --analyze
</pre></div>


<p>What you get so far is the possibility to run <code>systemctl start pgsql-vacuumdb@5432</code> instead of calling the underlying bash code manually. Not much, really. That&#8217;s where timers come to the&nbsp;party.</p>
<h3>Timers</h3>
<p>Timer files ends with &#8220;.timer&#8221; and are responsible for running services on given time. The code below, coming from <code>/lib/systemd/system/cr-sunday.timer</code> file runs the <code>pgsql-vacuumdb</code> service every Sunday at 3:45&nbsp;am.</p>
<div class="highlight"><pre><span></span><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>CR Sunday timer

<span class="o">[</span>Timer<span class="o">]</span>
<span class="nv">OnCalendar</span><span class="o">=</span>Sun *-*-* <span class="m">03</span>:45
<span class="nv">Persistent</span><span class="o">=</span>yes
<span class="nv">Unit</span><span class="o">=</span>cr-sunday.target

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>


<h3>Targets</h3>
<p>Target files end with &#8220;.target&#8221; and are used to group units in general. In our case, the target file for vacuumdb service is as simple as the following&nbsp;code.</p>
<div class="highlight"><pre><span></span><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>CR Sunday target
<span class="nv">StopWhenUnneeded</span><span class="o">=</span>yes
</pre></div>


<p>Targets might be called by other targets. Running <code>systemctl start cr-sunday.target</code> would eventually lead to running all the services wanted by that&nbsp;target.</p>
<p>As I already mentioned, I find systemd services easy to code and test. If any of them should fail, you&#8217;d find a message in syslog or via <code>systemctl status pgsql-vacuumdb</code>.</p>
</article>
<article>
    <h1><a href="https://www.zimmi.cz/posts/2018/postgresql-backup-and-recovery-orchestration-bash-automation/" rel="bookmark" title="Permalink to PostgreSQL Backup and Recovery Orchestration: Bash Automation">PostgreSQL Backup and Recovery Orchestration: Bash&nbsp;Automation</a></h1>
    <aside><span>Mar 2, 2018</span>
    <span>    <a class="tag-url" href="https://www.zimmi.cz/posts/tag/postgresql.html">postgresql</a>     <a class="tag-url" href="https://www.zimmi.cz/posts/tag/linux.html">linux</a>    </span>
    <span><a class="category-url" href="https://www.zimmi.cz/posts/category/sql.html">SQL</a></span>
    </aside>
    <p>There is a bunch of periodic database-related tasks in a life of PostgreSQL administrator. Some should be done daily, others weekly, others can wait for a whole month. Many of them are essential for your database health. Forget to run such a task or screw up the run accidentally, and you&#8217;ll be snowed under with fixing your&nbsp;database.</p>
<p>Those tasks are easily done with bash, which is the first step to full automation. Following tasks are perfect candidates to be implemented as bash&nbsp;scripts:</p>
<ul>
<li>full backups (both creation and&nbsp;removal)</li>
<li><span class="caps">WAL</span> backups (both creation and&nbsp;removal)</li>
<li>vacuum</li>
<li>pgBadger log analysis (both creation and&nbsp;removal)</li>
<li>log maintenance (if you don&#8217;t use log&nbsp;rotate)</li>
</ul>
<!-- -->

<p>Full backup creation is just one example of how powerful bash can&nbsp;be.</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1"># @author: Michal Zimmermann &amp;lt;michal.zimmermann@clevermaps.cz&amp;gt;</span>
<span class="c1"># Creates base backup.</span>

<span class="nv">CUR_DIR</span><span class="o">=</span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="k">if</span> <span class="o">[[</span> ! -f <span class="si">${</span><span class="nv">CUR_DIR</span><span class="si">}</span>/pgsql-common.sh <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;pgsql-common.sh not found!&quot;</span>
    <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nb">source</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CUR_DIR</span><span class="si">}</span><span class="s2">/pgsql-common.sh&quot;</span>
<span class="nb">source</span> <span class="s2">&quot;</span><span class="nv">$CONFIG</span><span class="s2">&quot;</span>

<span class="k">if</span> <span class="o">[[</span> -d <span class="si">${</span><span class="nv">CR_BASE_BACKUP_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">CR_LABEL</span><span class="si">}</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CR_BASE_BACKUP_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">CR_LABEL</span><span class="si">}</span><span class="s2"> already exists and is not empty!&quot;</span>
    <span class="nb">exit</span> <span class="m">2</span>
<span class="k">fi</span>

pg_basebackup <span class="se">\</span>
    --pgdata<span class="o">=</span><span class="si">${</span><span class="nv">CR_BASE_BACKUP_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">CR_LABEL</span><span class="si">}</span> <span class="se">\</span>
    --format<span class="o">=</span>plain <span class="se">\</span>
    --write-recovery-conf <span class="se">\</span>
    --wal-method<span class="o">=</span>stream <span class="se">\</span>
    --label<span class="o">=</span><span class="si">${</span><span class="nv">CR_LABEL</span><span class="si">}</span> <span class="se">\</span>
    --checkpoint<span class="o">=</span>fast <span class="se">\</span>
    --progress <span class="se">\</span>
    --verbose

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> -gt <span class="m">0</span> <span class="o">]]</span>
<span class="k">then</span>
    rm -rf <span class="si">${</span><span class="nv">CR_BASE_BACKUP_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">CR_LABEL</span><span class="si">}</span>
    <span class="nb">echo</span> <span class="s2">&quot;pg_basebackup on </span><span class="si">${</span><span class="nv">CR_LABEL</span><span class="si">}</span><span class="s2"> failed!&quot;</span>
    <span class="nb">exit</span> <span class="m">3</span>
<span class="k">fi</span>

tar -czf <span class="si">${</span><span class="nv">CR_BASE_BACKUP_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">CR_LABEL</span><span class="si">}</span>.tar.gz <span class="si">${</span><span class="nv">CR_BASE_BACKUP_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">CR_LABEL</span><span class="si">}</span> <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> rm -rf <span class="si">${</span><span class="nv">CR_BASE_BACKUP_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">CR_LABEL</span><span class="si">}</span>
</pre></div>


<p>As you probably noticed, a <code>pgsql-common.sh</code> file is sourced at the beginning of the script. This script in turn just loads the proper config file that provides variables to other, devops, scripts. As you might need those variables in several of your scripts, it is a good idea to put their load to a separate&nbsp;file.</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1"># @author: Michal Zimmermann &amp;lt;michal.zimmermann@clevermaps.cz&amp;gt;</span>
<span class="c1"># Sourced in pgsql-*.sh scripts.</span>

<span class="k">while</span> <span class="o">[[</span> <span class="nv">$#</span> <span class="p">&amp;</span>gt<span class="p">;</span> <span class="m">0</span> <span class="o">]]</span>
<span class="k">do</span>
    <span class="nv">key</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>

    <span class="k">case</span> <span class="nv">$key</span> in
        -c<span class="p">|</span>--config<span class="o">)</span>
            <span class="nv">CONFIG</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        *<span class="o">)</span>
            <span class="nb">echo</span> <span class="s2">&quot;Usage: `basename </span><span class="nv">$0</span><span class="s2">` --config|-c [config_file]&quot;</span>
            <span class="nb">exit</span> <span class="m">1</span>
            <span class="p">;;</span>
    <span class="k">esac</span>
    <span class="nb">shift</span>
<span class="k">done</span>
<span class="c1"># /Input parameters</span>

<span class="k">if</span> <span class="o">[[</span> -z <span class="s2">&quot;</span><span class="nv">$CONFIG</span><span class="s2">&quot;</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Config file is not set! See the script usage below.&quot;</span>
    <span class="nv">$0</span> *
    <span class="nb">exit</span> <span class="m">2</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> ! -f <span class="s2">&quot;</span><span class="nv">$CONFIG</span><span class="s2">&quot;</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$CONFIG</span><span class="s2"> not found!&quot;</span>
    <span class="nb">exit</span> <span class="m">3</span>
<span class="k">fi</span>
</pre></div>


<p>A config file might remain as simple as&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="c1"># Base backup location</span>
<span class="nb">export</span> <span class="nv">CR_BASE_BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/mnt/backup/symap/base/&quot;</span>
<span class="c1"># WAL backup location</span>
<span class="nb">export</span> <span class="nv">CR_WAL_BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/mnt/backup/symap/wal&quot;</span>
<span class="c1"># PostgreSQL WAL location</span>
<span class="nb">export</span> <span class="nv">CR_PG_XLOG_DIR</span><span class="o">=</span><span class="s2">&quot;/var/lib/postgresql/10/symap/pg_wal&quot;</span>
<span class="nb">export</span> <span class="nv">CR_PG_LOG_DIR</span><span class="o">=</span><span class="s2">&quot;/var/lib/postgresql/10/symap/pg_log&quot;</span>
<span class="c1"># Base backup pattern (set to YYYYMMDD)</span>
<span class="nb">export</span> <span class="nv">CR_LABEL</span><span class="o">=</span>symap_<span class="k">$(</span>date +%Y%m%d<span class="k">)</span>
<span class="nb">export</span> <span class="nv">PGPORT</span><span class="o">=</span><span class="m">5432</span>
</pre></div>


<p>Another, likely the simplest, example is a vacuumdb&nbsp;task:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1"># @author: Michal Zimmermann &amp;lt;michal.zimmermann@clevermaps.cz&amp;gt;</span>
<span class="c1"># Vacuums the whole database cluster running on a given port.</span>

<span class="k">while</span> <span class="o">[[</span> <span class="nv">$#</span> <span class="p">&amp;</span>gt<span class="p">;</span> <span class="m">0</span> <span class="o">]]</span>
<span class="k">do</span>
    <span class="nv">key</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>

    <span class="k">case</span> <span class="nv">$key</span> in
        -p<span class="p">|</span>--port<span class="o">)</span>
            <span class="nv">PORT</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
            <span class="nb">shift</span>
            <span class="p">;;</span>
        *<span class="o">)</span>
            <span class="nb">echo</span> <span class="s2">&quot;Usage: `basename </span><span class="nv">$0</span><span class="s2">` --port|-p [port_number]&quot;</span>
            <span class="nb">exit</span> <span class="m">1</span>
            <span class="p">;;</span>
    <span class="k">esac</span>
    <span class="nb">shift</span>
<span class="k">done</span>

<span class="k">if</span> <span class="o">[[</span> -z <span class="s2">&quot;</span><span class="nv">$PORT</span><span class="s2">&quot;</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Port not provided!&quot;</span>
    <span class="nv">$0</span> *
    <span class="nb">exit</span> <span class="m">2</span>
<span class="k">fi</span>

/usr/bin/vacuumdb -U postgres -p <span class="nv">$PORT</span> --all --full --analyze
</pre></div>


<h2>Tips</h2>
<ul>
<li>Always test your bash scripts before production deployment. Even a single line of code might lead to a very different, possibly unexpected,&nbsp;outcome.</li>
<li>Try to stay as defensive as possible. Imagine a variable did not get sourced properly. Is it going to blow your database? Trust me, I know what I am talking about (see the tweet&nbsp;below).</li>
</ul>
<blockquote class="twitter-tweet" data-lang="cs"><p lang="en" dir="ltr">that feeling when you blog about keeping your <a href="https://twitter.com/hashtag/postgresql?src=hash&amp;ref_src=twsrc%5Etfw">#postgresql</a> data safe and few days later you accidentally bzip all postgres-owned files <span class="caps">WHILE</span> the database is running with untested <a href="https://twitter.com/hashtag/bash?src=hash&amp;ref_src=twsrc%5Etfw">#bash</a> script. What a <a href="https://twitter.com/hashtag/tuesday?src=hash&amp;ref_src=twsrc%5Etfw">#tuesday</a>!</p>&mdash; Michal Zimmermann (@zimmicz) <a href="https://twitter.com/zimmicz/status/968546584567996416?ref_src=twsrc%5Etfw">27. února 2018</a></blockquote>

<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2>Pitfalls</h2>
<p>You do not want to run your bash scripts by hand. You probably do not want them to be run by cron. You want to run them with systemd. More on this next&nbsp;time.</p>
</article>
<aside id="pagination">
            <a href="https://www.zimmi.cz/posts/index2.html">Next page &raquo;</a>
</aside>    </main>
    <footer>
        Written by <a href="//www.zimmi.cz">Michal Zimmermann</a>.
        Proudly powered by <a href="//getpelican.com/">Pelican</a>,
        which takes great advantage of <a href="//python.org">Python</a>.
    </footer>
<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-43432739-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-43432739-2');
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NW8R37N');</script>
<!-- End Google Tag Manager -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NW8R37N"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
</body>
</html>